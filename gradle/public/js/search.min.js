function loadIndexJson(e) {
    var r = new XMLHttpRequest();
    if ("localhost" == window.location.hostname) var n = "http://localhost:1313/lunrindexjson.json";
    else n = "/lunrindexjson.json";
    r.overrideMimeType("application/json"),
        r.open("GET", n, !0),
        (r.onreadystatechange = function () {
            4 == r.readyState && e("200" == r.status ? JSON.parse(r.responseText) : null);
        }),
        r.send(null);
}
function addToSearchIndex(r, n) {
    return function (e) {
        e
            ? e.forEach(function (e) {
                  r.add(e), (n[e.ref] = e.title);
              })
            : (r.error = !0);
    };
}
function registerSearchHandler(r, n, e, t, o, c) {
    Array.prototype.slice.call(document.querySelectorAll(e)).forEach(function (e) {
        e.onclick = function (e) {
            e.preventDefault(), showSearchPage(r, n, t, o, c);
        };
    });
}
function showSearchPage(t, o, r, n, c) {
    (document.querySelector(r).style.display = "block"),
        t.error
            ? renderSearchError(c)
            : (document.querySelector(n).focus(),
              (document.querySelector(n).oninput = function (e) {
                  var r = e.target.value;
                  if ("" === r) renderSearchResults(o, c, null);
                  else {
                      var n = t.search(r);
                      renderSearchResults(o, c, n);
                  }
              }),
              (document.querySelector("#search-close").onclick = function (e) {
                  e.preventDefault(), hideSearchPage(r, n, c);
              }),
              (document.onkeyup = function (e) {
                  isKeyEscapeKeyPress(e) && (e.preventDefault(), hideSearchPage(r, n, c));
              }));
}
function isKeyEscapeKeyPress(e) {
    return "key" in e ? "Escape" == e.key || "Esc" == e.key : 27 == e.keyCode;
}
function hideSearchPage(e, r, n) {
    (document.querySelector(e).style.display = "none"), (document.querySelector(r).oninput = null), (document.querySelector(r).value = ""), renderSearchResults(null, n, null), (document.onkeyup = null);
}
function renderSearchError(e) {
    document.querySelector(e).innerHTML = '<p class="index-error">Sorry, there was a problem loading search. Please try reloading the page.</p>';
}
function renderSearchResults(r, e, n) {
    if (null != n)
        if (0 !== n.length) {
            var t = "<ul>";
            n.forEach(function (e) {
                t += '<li><a href="' + e.ref + '">' + r[e.ref] + "</a></li>";
            }),
                (t += "</ul>"),
                (document.querySelector(e).innerHTML = t);
        } else document.querySelector(e).innerHTML = '<p class="no-results">Nothing found for that query.</p>';
    else document.querySelector(e).innerHTML = "";
}
var searchIndex = lunr(function () {
        this.field("title", { boost: 10 }), this.field("tags", { boost: 5 }), this.field("content"), this.ref("ref");
    }),
    searchTitles = {};
registerSearchHandler(searchIndex, searchTitles, ".search-trigger", "#search-overlay", "#search-input", "#search-results"),
    loadIndexJson(addToSearchIndex(searchIndex, searchTitles)),
    $(function () {
        $('a[href="#searchfs"]').on("click", function (e) {
            e.preventDefault(), $("#searchfs").addClass("open"), $('#searchfs > form > input[type="search"]').focus();
        }),
            $("#searchfs, #searchfs button.close").on("click keyup", function (e) {
                (e.target != this && "close" != e.target.className && 27 != e.keyCode) || $(this).removeClass("open");
            });
    });
